---
{
"title": "How to deploy to Maven Central Repository",
"language": "en"
}
---

<!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

## Prepare

### 0. Requirements

1. apache account ID
2. apache password
3. gpg key

### 1. Prepare the local maven environment

1. Generate the master password: `mvn --encrypt-master-password <password>` This password is only used to encrypt other subsequent passwords, and the output is similar to `{VSb+6+76djkH/43...}` and then create` ~/.m2/settings-security.xml` file, the content is

   ```
   <settingsSecurity>
     <master>{VSb+6+76djkH/43...}</master>
   </settingsSecurity>
   ```

2. Encrypt apache password: `mvn --encrypt-password <password>` This password is the password of the apache account. The output is similar to the above `{GRKbCylpwysHfV...}` and added in `~/.m2/settings.xml`
   ```
     <servers>
       <!-- To publish a snapshot of your project -->
       <server>
         <id>apache.snapshots.https</id>
         <username>yangzhg</username>
         <password>{GRKbCylpwysHfV...}</password>
       </server>
       <!-- To stage a release of your project -->
       <server>
         <id>apache.releases.https</id>
         <username>yangzhg</username>
         <password>{GRKbCylpwysHfV...}</password>
       </server>
     </servers>
   ```

3. Optional, (you can also pass -Darguments="-Dgpg.passphrase=xxxx" during deployment), add the following content in `~/.m2/settings.xml`, if the profiles tag already exists, this is only required Just add profile to profiles, activeProfiles is the same as above, xxxx is the passphrase of the gpg key
   ```
     <profiles>
       <profile>
         <id>gpg</id>
         <properties>
           <gpg.executable>gpg</gpg.executable>
           <gpg.passphrase>xxxx</gpg.passphrase>
         </properties>
       </profile>
     </profiles>
     <activeProfiles>
       <activeProfile>gpg</activeProfile>
     </activeProfiles>
   ```
## Publish to SNAPSHOT
### 1. Deploy flink connector

Switch to the flink connector directory, let’s take flink version 1.11.6 and scalar 2.12 as examples

   ```
   cd incubator-doris/extension/flink-doris-connector
   export DORIS_HOME=$PWD/../../
   source ${DORIS_HOME}/env.sh
   if [ -f ${DORIS_HOME}/custom_env.sh ]; then source ${DORIS_HOME}/custom_env.sh; fi
   mvn deploy -Dflink.version=1.11.6 -Dscala.version=2.12
   ```



### 2. Deploy Spark connector

Switch to the spark connector directory, let’s take spark version 2.3.4 and scalar 2.11 as examples

   ```
   cd incubator-doris/extension/spark-doris-connector
   export DORIS_HOME=$PWD/../../
   source ${DORIS_HOME}/env.sh
   if [ -f ${DORIS_HOME}/custom_env.sh ]; then source ${DORIS_HOME}/custom_env.sh; fi
   mvn deploy -Dscala.version=2.11 -Dspark.version=2.3.4
   ```
## Publish to Release

### 1. Prepare GitHub authority
Encrypt github token password: `mvn --encrypt-password <token>` This token is a token generated by github users to access the apache warehouse. The output cat is similar to `{bSSA+TC6wzEHNKukcOn...}` in `~/.m2/settings. Add to the `<servers>` tag in xml`
```xml
    <server>
      <id>github</id>
      <username>github user name</username>
      <password>{bSSA+TC6wzEHNKukcOn...}</password>
    </server>
```

### 2. Publish to  maven staging
Take the release of Doris Flink Connector 1.0.0 as an example, the flink version is 1.13.5, the scala version is 2.12, and others are similar
```bash
cd extension/flink-doris-connector/
export DORIS_HOME=$PWD/../../
source ${DORIS_HOME}/env.sh
mvn release:clean -Dflink.version=1.13.5 -Dscala.version=2.12
mvn release:prepare -Dflink.version=1.13.5 -Dscala.version=2.12
```
After that, maven needs to enter three information
1. The version information of Doris Flink Connector, we can do it by default, you can directly press Enter or enter the version you want
2. The release tag of Doris Flink Connector, because the release process will add a tag in apache/incubator-doris, so a tag name is required. If it is default, just press Enter.
3. The version number of the next version of Doris Flink Connector. Here we need to pay attention. Since our version number is {flink_version}_{scala_version}_1.0.0, maven's algorithm will increase the scala version number by one, if we want to use it next time This version of 1.0.1 can be changed to 1.13.5-2.12-1.0.1-SNAPSHOT
```
...
[INFO] [prepare] 3/17 check-dependency-snapshots
[INFO] Checking dependencies and plugins for snapshots ...
[INFO] [prepare] 4/17 create-backup-poms
[INFO] [prepare] 5/17 map-release-versions
What is the release version for "Doris Flink Connector"? (org.apache.doris:doris-flink-connector) 1.13.5-2.12-1.0.0: :
[INFO] [prepare] 6/17 input-variables
What is the SCM release tag or label for "Doris Flink Connector"? (org.apache.doris:doris-flink-connector) doris-flink-connector-1.13.5-2.12-1.0.0: :
[INFO] [prepare] 7/17 map-development-versions
What is the new development version for "Doris Flink Connector"? (org.apache.doris:doris-flink-connector) 1.13.5-3.12-1.0.0-SNAPSHOT: : 1.13.5-2.12-1.0.1-SNAPSHOT
...
[INFO] [prepare] 17/17 end-release
[INFO] Release preparation complete.
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  01:00 min
[INFO] Finished at: 2022-01-05T15:01:55+08:00
[INFO] ------------------------------------------------------------------------
```
Perform after prepare, and after perform, find the just released version in stagingRepositories in `https://repository.apache.org/`
![](/images/staging_repo.png)

### 3. vote
You need to close staging before voting
![](/images/close_staging.png)
After that, you can vote in the dev@doris.apache.org, the following is an example of the mail
```
Hi,

We are ready to deploy Doris connectors to Maven Central Repository, as the version 1.0.0, and the next version will be 1.0.1
This Release contains Spark connectors and Flink connectors for spark 2/3 and flink 1.11/1.12/1.13

GitHub tags:
https://github.com/apache/incubator-doris/releases/tag/doris-spark-connector-3.1.2-2.12-1.0.0
https://github.com/apache/incubator-doris/releases/tag/doris-spark-connector-2.3.4-2.11-1.0.0
https://github.com/apache/incubator-doris/releases/tag/doris-flink-connector-1.13.5-2.12-1.0.0
https://github.com/apache/incubator-doris/releases/tag/doris-flink-connector-1.12.7-2.12-1.0.0
https://github.com/apache/incubator-doris/releases/tag/doris-flink-connector-1.11.6-2.12-1.0.0

Staging repo:
https://repository.apache.org/content/repositories/maven-[YOUR REPOSITORY ID]/
https://repository.apache.org/content/repositories/maven-[YOUR REPOSITORY ID]/[PATH-TO]-source-release.zip

Staging site:
https://repository.apache.org/content/repositories/orgapachedoris-1000

Vote open for at least 72 hours.

[ ] +1
[ ] +0
[ ] -1
```

After the vote is passed, it can be published to Maven Central
![](/images/release-stage.png)
